# Сервис звонков

Мини-сервис для управления звонками и аудиозаписями разговоров.

## Возможности
- Создание звонков с информацией о звонящем и принимающем
- Загрузка аудиозаписей для звонков
- Фоновая обработка записей (расчет продолжительности, транскрипция речи)
- Получение информации о звонках с деталями записи
- Поиск звонков по номеру телефона
- Отслеживание статуса звонков (создан, обрабатывается, готов)
- Обнаружение тишины в записях
- Предварительно подписанные URL-адреса для загрузки записей

## Технологический стек
- FastAPI
- PostgreSQL
- SQLAlchemy (асинхронный)
- Pydantic
- Celery
- pydub
- Uvicorn
- Docker

## Требования
- Python 3.9+
- PostgreSQL
- Docker (опционально, для контейнеризации)
- ffmpeg (для обработки аудио)

## Установка

1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # В Windows: venv\Scripts\activate
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
6. Настройте переменные окружения (см. `.env.example`)

7. Запустите приложение:
   ```bash
   uvicorn app.main:app --reload
   ```

## API эндпоинты
- `POST /api/v1/calls/` - Создать новый звонок
- `POST /api/v1/calls/{call_id}/recording/` - Загрузить запись для звонка
- `GET /api/v1/calls/{call_id}/` - Получить информацию о звонке
- `GET /api/v1/calls/?number={phone_number}` - Поиск звонков по номеру телефона

## Фоновые задачи
Фоновая обработка осуществляется с помощью Celery. Запустите воркер с помощью:
```bash
celery -A app.worker.tasks worker --loglevel=info
```


## Запуск с Docker
```bash
docker-compose up -d
```